<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Shopping Cart - E-Commerce Store</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .custom-alert {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 25px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            z-index: 10000;
            min-width: 300px;
            text-align: center;
        }
        .page-header {
            margin-bottom: 3rem;
            text-align: center;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        
        .custom-alert.show {
            display: block;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        
        .alert-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 9999;
        }
        
        .alert-overlay.show {
            display: block;
        }

        .cart-item {
            opacity: 1;
            transition: all 0.3s ease;
            display: flex;
            gap: 1.5rem;
            align-items: center;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .cart-item.removing {
            opacity: 0;
            transform: translateX(-100%);
        }

        .cart-item-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .cart-item-info {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #1f2937;
            font-weight: 600;
        }

        .cart-item-price {
            color: #6b7280;
            margin: 0;
        }

        .cart-item-actions {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f9fafb;
            padding: 0.5rem 1rem;
            border-radius: 10px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            background: #667eea;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quantity-btn:hover {
            background: #5568d3;
            transform: scale(1.1);
        }

        .quantity-display {
            min-width: 30px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .item-total {
            min-width: 100px;
            text-align: right;
        }

        .item-total-price {
            font-size: 1.3rem;
            font-weight: 800;
            color: #667eea;
            margin: 0;
        }

        /* Cart Total Styling */
        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .total-label {
            font-size: 1.2rem;
            color: #6b7280;
            text-align: left;
            flex-shrink: 0;
        }

        .total-value {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: right;
            white-space: nowrap;
        }

        .grand-total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 2px solid #667eea;
            gap: 1rem;
        }

        .grand-total-label {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: left;
        }

        .grand-total-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: #667eea;
            text-align: right;
            white-space: nowrap;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem;
                gap: 1rem;
            }

            .cart-item-image {
                width: 100%;
                height: 200px;
                max-width: 100%;
            }

            .cart-item-info {
                width: 100%;
            }

            .cart-item-name {
                font-size: 1.1rem;
            }

            .cart-item-actions {
                width: 100%;
                flex-direction: column;
                gap: 1rem;
            }

            .quantity-controls {
                width: 100%;
                justify-content: center;
                padding: 0.75rem 1rem;
            }

            .quantity-btn {
                width: 45px;
                height: 45px;
                font-size: 1.4rem;
            }

            .quantity-display {
                font-size: 1.3rem;
                min-width: 40px;
            }

            .item-total {
                width: 100%;
                text-align: center;
            }

            .item-total-price {
                font-size: 1.5rem;
            }

            .btn-danger {
                width: 100% !important;
                padding: 1rem !important;
                font-size: 1.1rem !important;
            }

            .cart-total {
                padding: 1rem !important;
            }

            /* Mobile alignment fixes */
            .total-row {
                margin-bottom: 0.75rem;
            }

            .total-label {
                font-size: 1rem;
            }

            .total-value {
                font-size: 1rem;
            }

            .grand-total-row {
                padding-top: 0.75rem;
            }

            .grand-total-label {
                font-size: 1.2rem;
            }

            .grand-total-value {
                font-size: 1.4rem;
            }

            .custom-alert {
                min-width: 90%;
                max-width: 95%;
                padding: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 1.5rem;
            }

            .cart-item {
                padding: 0.75rem;
            }

            .cart-item-image {
                height: 150px;
            }

            .cart-item-name {
                font-size: 1rem;
            }

            .cart-item-price {
                font-size: 0.9rem;
            }

            .quantity-btn {
                width: 40px;
                height: 40px;
            }

            .item-total-price {
                font-size: 1.3rem;
            }

            .total-label {
                font-size: 0.95rem;
            }

            .total-value {
                font-size: 0.95rem;
            }

            .grand-total-label {
                font-size: 1.1rem;
            }

            .grand-total-value {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Custom Alert -->
    <div class="alert-overlay" id="alertOverlay" onclick="closeCustomAlert()"></div>
    <div class="custom-alert" id="customAlert">
        <div style="font-size:3rem;margin-bottom:1rem;color:#ef4444;">üóëÔ∏è</div>
        <h3 id="alertTitle">Item Removed</h3>
        <p id="alertMessage" style="color:#6b7280;margin:1rem 0;">Item removed from cart</p>
        <button class="btn" onclick="closeCustomAlert()" style="margin-top:1rem;">OK</button>
    </div>
    
<div class="nav-overlay" id="navOverlay" onclick="toggleMobileMenu()"></div>
   <nav class="navbar">
    <h1 onclick="window.location.href='/'">üõí E-Commerce Store</h1>
    
    <!-- Hamburger Button -->
    <button class="menu-toggle" id="menuToggle" onclick="toggleMobileMenu()">‚ò∞</button>
    
    <div class="nav-links" id="navLinks">
        <a href="/">Home</a>
        <a href="/web/admin" id="adminLink" style="display:none;">Dashboard</a>
        <a href="/web/products">Products</a>
        <a href="/web/cart">Cart (<span id="cartCount">0</span>)</a>
        <a href="/web/orders" id="ordersLink" style="display:none;">My Orders</a>
        <a href="/web/profile" id="profileLink" style="display:none;">Profile</a>
        
        <span id="userName"></span>
        <button id="logoutBtn" style="display:none;" onclick="logout()">Logout</button>
        <a href="/web/login" id="loginLink">Login</a>
        <a href="/web/register" id="registerLink">Register</a>
    </div>
</nav>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">üõí Shopping Cart</h1>
            <p class="page-subtitle">Review your items before checkout</p>
        </div>
        <div class="cart-container">
        
            <div id="cartItems"></div>
            <div id="cartTotal" class="cart-total" style="display:none;">
                <div class="total-row">
                    <span class="total-label">Subtotal:</span>
                    <span class="total-value">$<span id="subtotalAmount">0.00</span></span>
                </div>
                <div class="total-row">
                    <span class="total-label">Estimated Shipping:</span>
                    <span id="shippingText" class="total-value" style="color:#10b981;">FREE</span>
                </div>
                <p id="shippingNote" style="font-size:0.9rem;color:#6b7280;margin:0.5rem 0;text-align:left;"></p>
                <p style="font-size:0.9rem;color:#6b7280;margin:1rem 0;font-style:italic;text-align:left;">
                    üí° Tax will be calculated at checkout based on your location
                </p>
                <div class="grand-total-row">
                    <span class="grand-total-label">Estimated Total:</span>
                    <span class="grand-total-value">$<span id="totalAmount">0.00</span></span>
                </div>
                <p style="font-size:0.85rem;color:#9ca3af;margin-top:0.5rem;text-align:left;">*Excluding tax</p>
                <button class="btn btn-success" onclick="window.location.href='/web/checkout'" style="margin-top:1.5rem;">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <script>
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        function logout() {
            localStorage.clear();
            window.location.href = '/';
        }

        function initNavbar() {
            const user = JSON.parse(localStorage.getItem('user'));
            const token = localStorage.getItem('token');
            
            updateCartCount();
            
            if (user && token) {
                document.getElementById('userName').textContent = 'Hi, ' + user.name;
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('ordersLink').style.display = 'inline-block';
                document.getElementById('profileLink').style.display = 'inline-block';
                document.getElementById('loginLink').style.display = 'none';
                document.getElementById('registerLink').style.display = 'none';
                
                if (user.role === 'ADMIN') {
                    document.getElementById('adminLink').style.display = 'inline-block';
                }
            }

        }

        function showCustomAlert(title, message) {
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('alertOverlay').classList.add('show');
            document.getElementById('customAlert').classList.add('show');
        }

        function closeCustomAlert() {
            document.getElementById('customAlert').classList.remove('show');
            document.getElementById('alertOverlay').classList.remove('show');
        }

        let shippingConfig = {
            shippingCost: 10.0,
            freeShippingThreshold: 50.0
        };

        async function loadShippingConfig() {
            try {
                const response = await fetch('/api/admin/shipping');
                if (response.ok) {
                    shippingConfig = await response.json();
                    console.log('üì¶ Shipping config loaded:', shippingConfig);
                }
            } catch (error) {
                console.log('Using default shipping config');
            }
        }

        function calculateTotals(cart) {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal >= shippingConfig.freeShippingThreshold ? 0 : shippingConfig.shippingCost;
            const total = subtotal + shipping;
            
            return { subtotal, shipping, total };
        }

        function updateTotals() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const { subtotal, shipping, total } = calculateTotals(cart);
            
            document.getElementById('subtotalAmount').textContent = subtotal.toFixed(2);
            document.getElementById('totalAmount').textContent = total.toFixed(2);
            
            const shippingText = document.getElementById('shippingText');
            const shippingNote = document.getElementById('shippingNote');
            
            if (shipping === 0) {
                shippingText.textContent = 'FREE ‚úì';
                shippingText.style.color = '#10b981';
                shippingNote.textContent = 'üéâ You qualify for free shipping!';
                shippingNote.style.color = '#10b981';
            } else {
                shippingText.textContent = '$' + shipping.toFixed(2);
                shippingText.style.color = '#6b7280';
                const needed = (shippingConfig.freeShippingThreshold - subtotal).toFixed(2);
                shippingNote.textContent = `Add $${needed} more to get FREE shipping!`;
                shippingNote.style.color = '#f59e0b';
            }
        }

        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            updateCartCount();

            if (cart.length === 0) {
                document.getElementById('cartItems').innerHTML = 
                    '<div class="empty-cart">' +
                    '<div style="font-size:5rem;margin-bottom:1rem;">üõí</div>' +
                    '<h3 style="font-size:2rem;margin-bottom:1rem;">Your cart is empty</h3>' +
                    '<p style="font-size:1.1rem;color:#6b7280;margin-bottom:2rem;">Add some amazing products to get started!</p>' +
                    '<a href="/web/products" class="btn" style="display:inline-block;width:auto;padding:1rem 2rem;text-decoration:none;">Browse Products</a>' +
                    '</div>';
                document.getElementById('cartTotal').style.display = 'none';
                return;
            }

            const html = cart.map((item, index) => {
                const itemTotal = item.price * item.quantity;
                const safeName = item.name.replace(/'/g, "\\'");
                
                return `
                    <div class="cart-item" id="cartItem${item.id}" style="animation-delay: ${index * 0.1}s;">
                        <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                        <div class="cart-item-info">
                            <h4 class="cart-item-name">${item.name}</h4>
                            <p class="cart-item-price">$${item.price.toFixed(2)} each</p>
                        </div>
                        <div class="cart-item-actions">
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">‚àí</button>
                                <span class="quantity-display">${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                            <div class="item-total">
                                <p class="item-total-price">$${itemTotal.toFixed(2)}</p>
                            </div>
                            <button onclick="removeFromCart(${item.id}, '${safeName}', event)" class="btn-danger" style="padding:0.8rem 1.2rem;border-radius:10px;white-space:nowrap;">
                                üóëÔ∏è Remove
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('cartItems').innerHTML = html;
            document.getElementById('cartTotal').style.display = 'block';
            updateTotals();
        }

        function updateQuantity(id, newQuantity) {
            if (newQuantity <= 0) {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const item = cart.find(i => i.id === id);
                removeFromCart(id, item ? item.name : 'Item');
                return;
            }

            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const item = cart.find(i => i.id === id);
            
            if (item && item.stock && newQuantity > item.stock) {
                showCustomAlert('Stock Limit', `Only ${item.stock} units available`);
                return;
            }
            
            cart = cart.map(item => 
                item.id === id ? { ...item, quantity: newQuantity } : item
            );
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }

        function removeFromCart(id, itemName, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const cartItemElement = document.getElementById('cartItem' + id);
            if (cartItemElement) {
                cartItemElement.classList.add('removing');
            }
            
            setTimeout(() => {
                let cart = JSON.parse(localStorage.getItem('cart') || '[]');
                cart = cart.filter(item => item.id !== id);
                localStorage.setItem('cart', JSON.stringify(cart));
                
                updateCartCount();
                loadCart();
                showCustomAlert('Item Removed üóëÔ∏è', itemName + ' has been removed from your cart');
            }, 300);
        }

        // Initialize on page load
        initNavbar();
        loadShippingConfig().then(() => {
            loadCart();
        });
        
        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            const overlay = document.getElementById('navOverlay');
            const menuToggle = document.getElementById('menuToggle');
            
            if (!navLinks || !overlay || !menuToggle) return;
            
            const isActive = navLinks.classList.contains('active');
            
            if (isActive) {
                navLinks.classList.remove('active');
                overlay.classList.remove('active');
                menuToggle.textContent = '‚ò∞';
                menuToggle.style.fontSize = '1.8rem';
                document.body.style.overflow = 'auto';
            } else {
                navLinks.classList.add('active');
                overlay.classList.add('active');
                menuToggle.textContent = '√ó';
                menuToggle.style.fontSize = '2.5rem';
                document.body.style.overflow = 'hidden';
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-links a, .nav-links button');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        const menu = document.getElementById('navLinks');
                        const overlay = document.getElementById('navOverlay');
                        if (menu && menu.classList.contains('active')) {
                            toggleMobileMenu();
                        }
                    }
                });
            });
        });
        
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                const navLinks = document.getElementById('navLinks');
                const overlay = document.getElementById('navOverlay');
                const menuToggle = document.getElementById('menuToggle');
                
                if (navLinks) navLinks.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
                if (menuToggle) {
                    menuToggle.textContent = '‚ò∞';
                    menuToggle.style.fontSize = '1.8rem';
                }
                document.body.style.overflow = 'auto';
            }
        });

    </script>
    <!-- Footer -->
<footer style="background:#1f2937;color:white;padding:3rem 2rem;margin-top:4rem;">
    <div style="max-width:1400px;margin:0 auto;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:3rem;margin-bottom:3rem;">
            <!-- Company Info -->
            <div>
                <h3 style="font-size:1.5rem;margin-bottom:1rem;font-weight:800;">üõí E-Commerce Store</h3>
                <p style="color:#9ca3af;line-height:1.6;">Your trusted online shopping destination for quality products at great prices.</p>
            </div>
            
            <!-- Quick Links -->
            <div>
                <h4 style="font-size:1.1rem;margin-bottom:1rem;font-weight:700;">Quick Links</h4>
                <ul style="list-style:none;padding:0;">
                    <li style="margin-bottom:0.5rem;"><a href="/" style="color:#9ca3af;text-decoration:none;transition:color 0.3s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">Home</a></li>
                    <li style="margin-bottom:0.5rem;"><a href="/web/products" style="color:#9ca3af;text-decoration:none;transition:color 0.3s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">Products</a></li>
                    <li style="margin-bottom:0.5rem;"><a href="/web/orders" style="color:#9ca3af;text-decoration:none;transition:color 0.3s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">My Orders</a></li>
                    <li style="margin-bottom:0.5rem;"><a href="/web/profile" style="color:#9ca3af;text-decoration:none;transition:color 0.3s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">Profile</a></li>
                </ul>
            </div>
            
            <!-- Customer Service -->
            <div>
                <h4 style="font-size:1.1rem;margin-bottom:1rem;font-weight:700;">Customer Service</h4>
                <ul style="list-style:none;padding:0;">
                    <li style="margin-bottom:0.5rem;"><a href="/web/contact" style="color:#9ca3af;text-decoration:none;transition:color 0.3s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">Contact Us</a></li>
                    <li style="margin-bottom:0.5rem;"><a href="/web/returns" style="color:#9ca3af;text-decoration:none;transition:color 0.3s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">Returns & Refunds</a></li>
                    <li style="margin-bottom:0.5rem;"><a href="/web/privacy" style="color:#9ca3af;text-decoration:none;transition:color 0.3s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">Privacy Policy</a></li>
                </ul>
            </div>
            
            <!-- Contact -->
            <div>
                <h4 style="font-size:1.1rem;margin-bottom:1rem;font-weight:700;">Get in Touch</h4>
                <p style="color:#9ca3af;margin-bottom:0.5rem;">üìß support@ecommerce.com</p>
                <p style="color:#9ca3af;margin-bottom:0.5rem;">üì± 1-800-SHOP-NOW</p>
                <p style="color:#9ca3af;">üìç 123 Commerce St, City, State 12345</p>
            </div>
        </div>
        
        <!-- Copyright Bar -->
        <div style="border-top:1px solid #374151;padding-top:2rem;text-align:center;">
            <p style="color:#9ca3af;margin-bottom:0.5rem;">
                ¬© <span id="currentYear"></span> E-Commerce Store. All rights reserved.
            </p>
            <p style="color:#6b7280;font-size:0.9rem;">
                Powered by Stripe | Secure Shopping Experience
            </p>
        </div>
    </div>
</footer>

<script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();
</script>
    
</body>
</html>